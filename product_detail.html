{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{{ product.name }}</title>
  
  <!-- Google Font -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap">
  
  <!-- Bootstrap CSS -->
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />

  <style>
    /* ------------------------------
       GLOBAL STYLES & BACKGROUND
       ------------------------------ */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Montserrat', sans-serif;
      /* Modern gradient: from #667eea torgb(75, 162, 127) */
      background: linear-gradient(to bottom right, #667eea,hsl(142, 36.70%, 46.50%));
      min-height: 100vh;
      color: #fff;
    }

    a { 
      text-decoration: none; 
      color: inherit; 
    }

    .hero-section {
      /* Updated gradient: from #ff9966 to #ff5e62 */
      background: linear-gradient(135deg, #ff9966, #ff5e62);
      border-radius: 20px;
      margin: 40px auto;
      max-width: 1400px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
      overflow: hidden;
      padding: 40px;
    }

    .product-image {
      width: 100%;
      max-width: 600px;
      border-radius: 15px;
      box-shadow: 0 4px 15px rgba(0,0,0,0.3);
      transition: transform 0.4s ease;
    }
    .product-image:hover { 
      transform: scale(1.05); 
    }

    .product-info {
      margin-top: 20px;
      padding: 20px;
    }

    .product-title {
      font-size: 100px;
      font-weight: 700;
      color: #222; /* Darker text for contrast */
      margin-bottom: 15px;
      text-shadow: 2px 2px 10px rgba(255,255,255,0.4);
    }
    .product-desc {
      font-size: 30px;
      color: #333; /* Slightly darker */
      margin-bottom: 25px;
    }
    .product-price {
      font-size: 50px;
      font-weight: 700;
      color:rgb(109, 80, 255); /* Vibrant red/pink */
      margin-bottom: 30px;
      text-shadow: 1px 1px 5px rgba(255,79,122,0.3);
    }

    /* ------------------------------
       ADD TO CART BUTTON
       ------------------------------ */
    .btn-add-cart {
      /* Updated gradient: from #ff9966 to #ff5e62 */
      background: linear-gradient(45deg, #ff9966, #ff5e62);
      border: none;
      color: #fff;
      padding: 14px 28px;
      font-size: 18px;
      border-radius: 30px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      font-weight: 600;
      width: 60%;
      max-width: 250px;
      text-align: center;
    }
    .btn-add-cart:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(255,94,98,0.5);
    }

    /* ------------------------------
       RESPONSIVE HERO
       ------------------------------ */
    @media (max-width: 768px) {
      .hero-row {
        padding: 20px;
      }
      .product-info {
        margin-top: 30px;
      }
      .product-title {
        font-size: 32px;
      }
      .product-price {
        font-size: 28px;
      }
    }

    /* ------------------------------
       SECTION HEADINGS
       ------------------------------ */
    .section-title {
      font-size: 28px;
      font-weight: 700;
      color: #222;
      margin-bottom: 25px;
      border-left: 6px solid #ff5e62;
      padding-left: 15px;
      text-shadow: 1px 1px 3px rgba(255,79,122,0.2);
    }

    /* ------------------------------
       REVIEWS & SIMILAR SECTIONS
       ------------------------------ */
    .reviews-section, .similar-section {
      /* Slightly more opaque white background */
      background: rgba(255,255,255,0.15);
      margin: 40px auto;
      padding: 30px;
      border-radius: 20px;
      max-width: 1200px;
      box-shadow: 0 8px 20px rgba(0,0,0,0.2);
    }

    .review-card {
      background: rgba(255,255,255,0.85);
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 15px;
      color: #333;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .review-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 15px rgba(0,0,0,0.1);
    }
    .review-author {
      font-weight: 600;
      margin-bottom: 5px;
    }
    .review-rating {
      color: #ff5757;
      margin-left: 5px;
    }

    /* ------------------------------
       CUSTOM BUTTONS
       ------------------------------ */
    .btn-custom {
      padding: 14px 28px;
      font-size: 18px;
      border-radius: 30px;
      font-weight: 600;
      width: 60%;
      max-width: 250px;
      text-align: center;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }
    .btn-add-cart {
      background: linear-gradient(45deg, #ff512f, #dd2476); 
      color: #fff; 
    }
    .btn-recommend { 
      background: linear-gradient(45deg, #00c6ff, #0072ff); 
      color: #fff; 
    }
    .btn-custom:hover { 
      transform: translateY(-3px); 
      box-shadow: 0 8px 20px rgba(0,0,0,0.3); 
    }

    /* ------------------------------
       SIMILAR PRODUCTS CARDS
       ------------------------------ */
    .card {
      background: rgba(255,255,255,0.7);
      border: none;
      border-radius: 10px;
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      overflow: hidden;
    }
    .card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    }
    .card img {
      border-radius: 10px 10px 0 0;
      object-fit: cover;
      height: 200px;
      width: 100%;
    }
    .card h5 {
      color: #222;
      margin-top: 15px;
      font-weight: 600;
    }
    .card .text-success {
      color: #ff4f7a !important;
      font-weight: 600;
    }

    /* ------------------------------
       MODAL FOR LARGER IMAGES
       ------------------------------ */
    .image-modal {
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      z-index: 9999;
    }
    .image-modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      text-align: center;
      position: relative;
      max-width: 90%;
      max-height: 90%;
      overflow: auto;
    }
    .large-product-image {
      max-width: 80%;
      height: auto;
      border-radius: 10px;
      transition: transform 0.3s ease;
    }
    .large-product-image:hover {
      transform: scale(1.05);
    }
    .close-modal {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 28px;
      cursor: pointer;
      color: #555;
    }
    .close-modal:hover {
      color: #000;
    }

    /* ------------------------------
       RECOMMENDED ITEM
       ------------------------------ */
       /* Ensure recommended items are displayed correctly */
       .recommended-container {
         display: flex;
         flex-wrap: wrap;
         justify-content: center; /* Center align */
         gap: 20px; /* Space between items */
         align-items: flex-start; /* Align to the top */
       }
       
       .recommended-item {
         flex: 1 1 250px; /* Allow flexible growth but maintain structure */
         max-width: 250px;
         text-align: center;
       }
       
       /* Ensure all recommended product images have the same height */
       .recommended-product-image {
         width: 100%;
         height: 220px; /* Set a fixed height */
         object-fit: cover;
         border-radius: 10px;
         transition: transform 0.3s ease;
       }
       
       .recommended-product-image:hover {
         transform: scale(1.05);
       }
       
  </style>
</head>
<body>

  <!-- HERO SECTION: Product Display -->
  {% comment %} 
  <div class="hero-section">
    <div class="hero-row">
      <!-- Product Image -->
      <div class="col-md-6 d-flex justify-content-center">
        <img
          src="{{ product.image.url }}"
          alt="{{ product.name }}"
          class="product-image"
        />
      </div> 
  {% endcomment %}
    <!-- HERO SECTION: Product Display -->
<div class="hero-section">
  <div class="row align-items-center"> <!-- MAKE SURE THIS IS NOT COMMENTED OUT -->
    
    <!-- LEFT COLUMN (Product Image & Recommend Button) -->
    <div class="col-md-6 text-center d-flex flex-column align-items-center">
      <img id="product-image" src="{{ product.image.url }}" alt="{{ product.name }}" class="product-image" />
      <button id="recommend-btn" class="btn btn-custom btn-recommend mt-3">Recommend</button>
    
      <!-- Recommended Products go here -->
      <div class="mt-4">
        <h3>Similar Products</h3>
        <div id="recommended-products" class="row flex-row flex-nowrap recommended-container" style="overflow-x: auto;"></div>

      </div>
    </div>

    <!-- RIGHT COLUMN (Product Details) -->
    <div class="col-md-6 product-info">
      <h2 class="product-title">{{ product.name }}</h2>
      <p class="product-desc">{{ product.description }}</p>
      <div class="product-price">${{ product.price }}</div>
      <form action="{% url 'add_to_cart' product.id %}" method="POST">
        {% csrf_token %}
        <button type="submit" class="btn btn-primary" style="font-size: 18px; padding: 12px 24px;">Add to Cart</button>

    </form>
    

    </div>

  </div>
</div>

<script>
document.getElementById("recommend-btn").addEventListener("click", function() {
  let imageUrl = document.getElementById("product-image").src;
  let imageFilename = imageUrl.split("/").pop().split("?")[0]; 

  fetch(`/get_similar_products?image=` + encodeURIComponent(imageFilename))
      .then(response => response.json())
      .then(data => {
          console.log("Full recommendation response:", data);
          
          let container = document.getElementById("recommended-products");
          container.innerHTML = ""; // Clear previous results

          if (data.error) {
              container.innerHTML = `
                  <p class="text-danger">
                      ${data.error} <br>
                      Available Images: ${data.available_images ? data.available_images.join(", ") : "None"}
                  </p>`;
              return;
          }

          if (!data.similar_products || data.similar_products.length === 0) {
              container.innerHTML = `<p class="text-warning">No similar products found.</p>`;
              return;
          }

          data.similar_products.forEach(product => {
              let productCard = document.createElement("div");
              productCard.classList.add("col-auto", "text-center", "mb-3", "recommended-item");

              productCard.innerHTML = `
                  <div class="card h-100" style="width: 200px;">
                      <a href="${product.url}" target="_blank">
                          <img src="${product.image}" class="card-img-top recommended-product-image" alt="${product.name}">
                      </a>
                      <div class="card-body p-2">
                          <h5 class="card-title">${product.name}</h5> <!-- FIXED NAME DISPLAY -->
                      </div>
                  </div>
              `;

              container.appendChild(productCard);
          });
      })
      .catch(error => {
          console.error("Recommendation fetch error:", error);
      });
});
function addToCart(productId) {
  // Retrieve existing cart items from local storage
  let cart = JSON.parse(localStorage.getItem("cart")) || [];

  // Get product details from the page
  let productName = document.querySelector(".product-title").innerText;
  let productPrice = document.querySelector(".product-price").innerText.replace("$", "");
  let productDesc = document.querySelector(".product-desc").innerText;

  // Add new product to cart
  cart.push({
      id: productId,
      name: productName,
      price: parseFloat(productPrice),
      description: productDesc
  });

  // Save updated cart back to localStorage
  localStorage.setItem("cart", JSON.stringify(cart));

  // Redirect user to the cart page
  window.location.href = "/cart/";
}
</script
    
  <!-- REVIEWS SECTION -->
  <div class="reviews-section">
    <h3 class="section-title">Customer Reviews</h3>
    {% if reviews %}
      {% for review in reviews %}
        <div class="review-card">
          <div class="review-author">
            {{ review.customer_name }}
            <span class="review-rating">⭐{{ review.rating }}/5</span>
          </div>
          <p>{{ review.comment }}</p>
        </div>
      {% endfor %}
    {% else %}
      <p>No reviews yet. Be the first to review!</p>
    {% endif %}
  </div>

  <!-- SIMILAR PRODUCTS SECTION -->
  <div class="similar-section">
    <h3 class="section-title">Similar Products</h3>
    <div class="row g-4">
      {% for similar_product in similar_products %}
      <div class="col-md-3 col-sm-6">
        <a href="{% url 'product_detail' similar_product.id %}">
          <div class="card">
            <img
              src="{{ similar_product.image.url }}"
              alt="{{ similar_product.name }}"
            />
            
            <div class="p-3">
              <h5>{{ similar_product.name }}</h5>
              <p class="text-success">${{ similar_product.price }}</p>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
